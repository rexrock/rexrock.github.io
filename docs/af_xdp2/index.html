<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="向云原生进击 Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="向云原生进击 Blog Atom Feed"><title data-react-helmet="true">AF_XDP VS DPDK | 向云原生进击</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="AF_XDP VS DPDK | 向云原生进击"><meta data-react-helmet="true" name="description" content="目前 ovs、dpdk、cilium均对 AFXDP 做了支持，这是否预示在高性能报文转发方面 AFXDP未来将成为DPDK外又一重要技术分支？加之AFXDP跟内核更好的配合，随着技术不断程序，AFXDP是否会全面超越甚至取代DPDK成为高性能报文转发的首选？未来不得而知，但至少从目前看，AF_XDP性能上仍不及DPDK，下面通过一个简单的测试来具体看一下。"><meta data-react-helmet="true" property="og:description" content="目前 ovs、dpdk、cilium均对 AFXDP 做了支持，这是否预示在高性能报文转发方面 AFXDP未来将成为DPDK外又一重要技术分支？加之AFXDP跟内核更好的配合，随着技术不断程序，AFXDP是否会全面超越甚至取代DPDK成为高性能报文转发的首选？未来不得而知，但至少从目前看，AF_XDP性能上仍不及DPDK，下面通过一个简单的测试来具体看一下。"><meta data-react-helmet="true" property="og:url" content="https://rexrock.github.io/docs/af_xdp2"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://rexrock.github.io/docs/af_xdp2"><link rel="stylesheet" href="/styles.157dcc77.css">
<link rel="preload" href="/styles.831a2ed6.js" as="script">
<link rel="preload" href="/runtime~main.38468e1e.js" as="script">
<link rel="preload" href="/main.7dbf3cb3.js" as="script">
<link rel="preload" href="/1.074cd580.js" as="script">
<link rel="preload" href="/2.585a96c2.js" as="script">
<link rel="preload" href="/36.a7932f05.js" as="script">
<link rel="preload" href="/37.7782d26b.js" as="script">
<link rel="preload" href="/935f2afb.bb407386.js" as="script">
<link rel="preload" href="/17896441.78c5a4aa.js" as="script">
<link rel="preload" href="/2c81fb77.f0eb65ae.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/author.jpg" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/author.jpg" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">阳仔的博客</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/author.jpg" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/author.jpg" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">阳仔的博客</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">eBPF</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/">eBPF的使用限制</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ebpf2">Run ebpf with tc</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/xdp1">XDP技术简介</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/af_xdp1">AF_XDP技术详解</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/af_xdp2">AF_XDP VS DPDK</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Cilium</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/k8s-net2">Cilium简介</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cilium1">Cilium datapath梳理</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Kubernetes</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">入门</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/k8s1">使用kubeadm搭建一个k8s集群</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/k8s2">使用kubebuilder创建CRD及Controller</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/k8s3">使用istio + servicemesh搭建服务网格</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">网络</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/k8s-net1">Flannel和Calico简介</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/k8s-net2">Cilium简介</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/k8s-sriov1">玩转sriov-network-device-plugin（一）</a></li></ul></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">AF_XDP VS DPDK</h1></header><div class="markdown"><p>目前 ovs、dpdk、cilium均对 AF_XDP 做了支持，这是否预示在高性能报文转发方面 AF_XDP未来将成为DPDK外又一重要技术分支？加之AF_XDP跟内核更好的配合，随着技术不断程序，AF_XDP是否会全面超越甚至取代DPDK成为高性能报文转发的首选？未来不得而知，但至少从目前看，AF_XDP性能上仍不及DPDK，下面通过一个简单的测试来具体看一下。</p><blockquote><p>说明：本次测试，AF_XDP时NATIVE模式，而不是NATIVE_WITH_ZEROCOPY模式，在CX5网卡上 ZEROCOPY开启失败，看来需要网卡的支持，后续再调试解决吧。不开启zerocopy，根据以往测试经验性能可能会有20%-30%的下降。</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="1-测试拓扑"></a>1. 测试拓扑<a class="hash-link" href="#1-测试拓扑" title="Direct link to heading">#</a></h2><p><img alt="enter description here" src="data:image/png;base64,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"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="2-软件版本"></a>2. 软件版本<a class="hash-link" href="#2-软件版本" title="Direct link to heading">#</a></h2><p>OVS-2.12 + DPDK-20.11 + KERNEL-5.4.87，具体要求及ovs编译配置参考：
<a href="https://docs.openvswitch.org/en/latest/intro/install/afxdp/?highlight=native-with-zerocopy#setup-af-xdp-netdev" target="_blank" rel="noopener noreferrer">Open vSwitch with AF_XDP</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="3-ovs配置"></a>3. OVS配置<a class="hash-link" href="#3-ovs配置" title="Direct link to heading">#</a></h2><p><strong>OVS编译：</strong></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">./configure --prefix=/usr/ --enable-afxdp --with-dpdk --with-debug CFLAGS=&quot;-O3&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">make &amp;&amp; make install</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><strong>OVS初始化及网络配置：</strong></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-javascript codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">usr</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">bin</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">ovs</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">vsctl </span><span class="token operator" style="color:rgb(137, 221, 255)">--</span><span class="token plain">no</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">wait </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> </span><span class="token maybe-class-name">Open_vSwitch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"> </span><span class="token property-access">other_config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">pmd</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">cpu</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">mask</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">0x550</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">init_dpdk</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ovs</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">vsctl </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> </span><span class="token maybe-class-name">Open_vSwitch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"> </span><span class="token property-access">other_config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">dpdk</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">init</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">usr</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">bin</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">ovs</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">vsctl </span><span class="token operator" style="color:rgb(137, 221, 255)">--</span><span class="token plain">no</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">wait </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> </span><span class="token maybe-class-name">Open_vSwitch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"> </span><span class="token property-access">other_config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">dpdk</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">socket</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">mem</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">2048</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">usr</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">bin</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">ovs</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">vsctl </span><span class="token operator" style="color:rgb(137, 221, 255)">--</span><span class="token plain">no</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">wait </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> </span><span class="token maybe-class-name">Open_vSwitch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"> </span><span class="token property-access">other_config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">dpdk</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">extra</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;-a 0000:5e:00.0,txq_inline=128,txqs_min_inline=4,txq_mpw_en=0 -a 0000:5e:00.0,txq_inline=128,txqs_min_inline=4,txq_mpw_en=0&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">add_xdp_port</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ovs</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">vsctl </span><span class="token operator" style="color:rgb(137, 221, 255)">--</span><span class="token plain"> add</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">br br0 \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token operator" style="color:rgb(137, 221, 255)">--</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> </span><span class="token maybe-class-name">Bridge</span><span class="token plain"> br0 datapath_type</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">netdev</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ovs</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">vsctl add</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">port br0 ens2f0 \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token operator" style="color:rgb(137, 221, 255)">--</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">interface</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ens2f0</span><span class="token plain"> type</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;afxdp&quot;</span><span class="token plain"> options</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">xdp</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">mode</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">native</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token keyword" style="font-style:italic">with</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">zerocopy options</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">n_rxq</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token plain"> other_config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">pmd</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">rxq</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">affinity</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;0:4,1:6,2:8,3:10&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ovs</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">vsctl add</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">port br0 ens2f1 \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token operator" style="color:rgb(137, 221, 255)">--</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">interface</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ens2f1</span><span class="token plain"> type</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;afxdp&quot;</span><span class="token plain"> options</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">xdp</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">mode</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">native</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token keyword" style="font-style:italic">with</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">zerocopy options</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">n_rxq</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token plain"> other_config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">pmd</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">rxq</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">affinity</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;0:4,1:6,2:8,3:10&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">add_dpdk_port</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ovs</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">vsctl </span><span class="token operator" style="color:rgb(137, 221, 255)">--</span><span class="token plain">may</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">exist add</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">br br0 \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token operator" style="color:rgb(137, 221, 255)">--</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> </span><span class="token maybe-class-name">Bridge</span><span class="token plain"> br0 datapath_type</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">netdev \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token operator" style="color:rgb(137, 221, 255)">--</span><span class="token plain"> br</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token keyword" style="font-style:italic">set</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">external</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">id br0 bridge</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">id br0 \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token operator" style="color:rgb(137, 221, 255)">--</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> bridge br0 fail</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">mode</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">secure</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ovs</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">vsctl </span><span class="token operator" style="color:rgb(137, 221, 255)">--</span><span class="token plain">timeout </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token plain"> add</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">port br0 ens2f0 \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token operator" style="color:rgb(137, 221, 255)">--</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> </span><span class="token maybe-class-name">Interface</span><span class="token plain"> ens2f0 type</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">dpdk options</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">dpdk</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">devargs</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">0000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token plain">e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">00.0</span><span class="token plain"> options</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">n_rxq</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token plain"> other_config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">pmd</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">rxq</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">affinity</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;0:4,1:6,2:8,3:10&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ovs</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">vsctl </span><span class="token operator" style="color:rgb(137, 221, 255)">--</span><span class="token plain">timeout </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token plain"> add</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">port br0 ens2f1 \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token operator" style="color:rgb(137, 221, 255)">--</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> </span><span class="token maybe-class-name">Interface</span><span class="token plain"> ens2f1 type</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">dpdk options</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">dpdk</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">devargs</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">0000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token plain">e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">00.1</span><span class="token plain"> options</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">n_rxq</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token plain"> other_config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">pmd</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">rxq</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">affinity</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;0:4,1:6,2:8,3:10&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#init_dpdk</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#sleep </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#add_dpdk_port</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">add_xdp_port</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><strong>OVS流表配置：</strong></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-javascript codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">ovs</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">ofctl del</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">flows br0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ovs</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">ofctl add</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">flow br0 table</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">priority</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">action</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">normal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ovs</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">ofctl add</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">flow br0 table</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">priority</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">action</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">normal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ovs</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">ofctl add</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">flow br0 table</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">priority</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">20</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">ip</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">dl_src</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">b8</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">59</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">9</span><span class="token plain">f</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">41</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">d6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">in_port</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">ens2f0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">action</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">load</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">\</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token constant" style="color:rgb(130, 170, 255)">NXM_OF_IN_PORT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">goto_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ovs</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">ofctl add</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">flow br0 table</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">priority</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">20</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">ip</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">dl_src</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">b8</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">59</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">9</span><span class="token plain">f</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">41</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">d7</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">in_port</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">ens2f1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">action</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">load</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">\</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token constant" style="color:rgb(130, 170, 255)">NXM_OF_IN_PORT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">goto_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ovs</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">ofctl add</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">flow br0 table</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">priority</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">20</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">ip</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">nw_dst</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">172.10</span><span class="token number" style="color:rgb(247, 140, 108)">.1</span><span class="token number" style="color:rgb(247, 140, 108)">.1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">action</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">set_field</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">b8</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">59</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">9</span><span class="token plain">f</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">41</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">11</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">8</span><span class="token plain">e</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">\</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">eth_src</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">set_field</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">b8</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">59</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">9</span><span class="token plain">f</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">41</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">d6</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">\</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">eth_dst</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">output</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">ens2f0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ovs</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">ofctl add</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">flow br0 table</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">priority</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">20</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">ip</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">nw_dst</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">172.10</span><span class="token number" style="color:rgb(247, 140, 108)">.2</span><span class="token number" style="color:rgb(247, 140, 108)">.1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">action</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">set_field</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">b8</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">59</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">9</span><span class="token plain">f</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">41</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">11</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">8</span><span class="token plain">f</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">\</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">eth_src</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">set_field</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">b8</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">59</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">9</span><span class="token plain">f</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">41</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">d7</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">\</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">eth_dst</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">output</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">ens2f1</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="4-node配置"></a>4. NODE配置<a class="hash-link" href="#4-node配置" title="Direct link to heading">#</a></h2><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-javascript codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">ip netns add net1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ip netns add net2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sleep </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ip link </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> ens2f0 netns net1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ip link </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> ens2f1 netns net2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sleep </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ip netns exec net1 ifconfig ens2f0 </span><span class="token number" style="color:rgb(247, 140, 108)">172.10</span><span class="token number" style="color:rgb(247, 140, 108)">.1</span><span class="token number" style="color:rgb(247, 140, 108)">.1</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token number" style="color:rgb(247, 140, 108)">24</span><span class="token plain"> up</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ip netns exec net2 ifconfig ens2f1 </span><span class="token number" style="color:rgb(247, 140, 108)">172.10</span><span class="token number" style="color:rgb(247, 140, 108)">.2</span><span class="token number" style="color:rgb(247, 140, 108)">.1</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token number" style="color:rgb(247, 140, 108)">24</span><span class="token plain"> up</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ip netns exec net1 route add </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">net </span><span class="token number" style="color:rgb(247, 140, 108)">172.10</span><span class="token number" style="color:rgb(247, 140, 108)">.2</span><span class="token number" style="color:rgb(247, 140, 108)">.0</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token number" style="color:rgb(247, 140, 108)">24</span><span class="token plain"> gw </span><span class="token number" style="color:rgb(247, 140, 108)">172.10</span><span class="token number" style="color:rgb(247, 140, 108)">.1</span><span class="token number" style="color:rgb(247, 140, 108)">.2</span><span class="token plain"> dev ens2f0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ip netns exec net2 route add </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">net </span><span class="token number" style="color:rgb(247, 140, 108)">172.10</span><span class="token number" style="color:rgb(247, 140, 108)">.1</span><span class="token number" style="color:rgb(247, 140, 108)">.0</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token number" style="color:rgb(247, 140, 108)">24</span><span class="token plain"> gw </span><span class="token number" style="color:rgb(247, 140, 108)">172.10</span><span class="token number" style="color:rgb(247, 140, 108)">.2</span><span class="token number" style="color:rgb(247, 140, 108)">.2</span><span class="token plain"> dev ens2f1</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="5-测试结果"></a>5. 测试结果<a class="hash-link" href="#5-测试结果" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="51-throughput"></a>5.1 Throughput<a class="hash-link" href="#51-throughput" title="Direct link to heading">#</a></h3><p>单口25G网卡，带宽AF_XDP和DPDK两种场景下带宽都能够打满：</p><p><img alt="Throughput" src="/assets/images/1614652578603-99a5ceb9a4bfb6b472331021eeed06d9.png"></p><p>我们主要看下，相同带宽下，各自的PMD使用率：</p><p><img alt="AF_XDP" src="/assets/images/1614652639030-33dca24830f38feece389759f070e10a.png"></p><p><img alt="DPDK" src="/assets/images/1614652664832-0bfef1ad2080b45859cee6e7e9b560cd.png"></p><p>很明显，DPDK PMD使用率更低，并且hash的更均匀；</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="52-pps"></a>5.2 PPS<a class="hash-link" href="#52-pps" title="Direct link to heading">#</a></h3><p>AF_XDP：327W pps
DPDK：1400W pps</p><p>并且各自峰值的情况下，PMD使用率DPDK仍是全面占优：</p><p><img alt="AF_XDP" src="/assets/images/1614652872603-989fc59771cfa2c652b15f7c31e5f79a.png"></p><p><img alt="DPDK" src="/assets/images/1614652884076-429efa5b77a05025e0f851b611506bdc.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="53-latency"></a>5.3 Latency<a class="hash-link" href="#53-latency" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-javascript codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">netperf </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">t </span><span class="token constant" style="color:rgb(130, 170, 255)">TCP_RR</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token constant" style="color:rgb(130, 170, 255)">H</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">172.10</span><span class="token number" style="color:rgb(247, 140, 108)">.2</span><span class="token number" style="color:rgb(247, 140, 108)">.1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">l </span><span class="token number" style="color:rgb(247, 140, 108)">30</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">--</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">r </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">B</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">B </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token constant" style="color:rgb(130, 170, 255)">O</span><span class="token plain">  </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;MAX_LATENCY,MEAN_LATENCY,P90_LATENCY,P99_LATENCY,P999_LATENCY,P9999_LATENCY,STDDEV_LATENCY,THROUGHPUT,THROUGHPUT_UNITS&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><img alt="TCP_RR" src="/assets/images/1614653034804-5b5051b6e77f9eb63a79635cd5a01c82.png"></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">netperf -t TCP_CRR -H 172.10.2.1 -l 30 -- -r 1B,1B -O  &quot;MAX_LATENCY,MEAN_LATENCY,P90_LATENCY,P99_LATENCY,P999_LATENCY,P9999_LATENCY,STDDEV_LATENCY,THROUGHPUT,THROUGHPUT_UNITS&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><img alt="TCP_CRR" src="/assets/images/1614653168657-840237aa66991e4cd6d59e27759eeb31.png"></p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/docs/ad_xdp2.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/af_xdp1"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« AF_XDP技术详解</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/k8s-net2"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Cilium简介 »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-测试拓扑" class="table-of-contents__link">1. 测试拓扑</a></li><li><a href="#2-软件版本" class="table-of-contents__link">2. 软件版本</a></li><li><a href="#3-ovs配置" class="table-of-contents__link">3. OVS配置</a></li><li><a href="#4-node配置" class="table-of-contents__link">4. NODE配置</a></li><li><a href="#5-测试结果" class="table-of-contents__link">5. 测试结果</a><ul><li><a href="#51-throughput" class="table-of-contents__link">5.1 Throughput</a></li><li><a href="#52-pps" class="table-of-contents__link">5.2 PPS</a></li><li><a href="#53-latency" class="table-of-contents__link">5.3 Latency</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">Style Guide</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/doc2/">Second Doc</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.831a2ed6.js"></script>
<script src="/runtime~main.38468e1e.js"></script>
<script src="/main.7dbf3cb3.js"></script>
<script src="/1.074cd580.js"></script>
<script src="/2.585a96c2.js"></script>
<script src="/36.a7932f05.js"></script>
<script src="/37.7782d26b.js"></script>
<script src="/935f2afb.bb407386.js"></script>
<script src="/17896441.78c5a4aa.js"></script>
<script src="/2c81fb77.f0eb65ae.js"></script>
</body>
</html>